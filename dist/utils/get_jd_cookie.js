import e from"request";import t from"fs";import o from"path";var r={};const n=(i="string"==typeof $argument&&$argument||"",Object.fromEntries(i.split("&").map((e=>e.split("=")))));var i;Number(n.debug);var s=Number(n.deleteCookie),l=function(){const r="undefined"!=typeof $request,n="undefined"!=typeof $httpClient,i="undefined"!=typeof $task,s="undefined"!=typeof $loon,l="undefined"!=typeof $app&&"undefined"!=typeof $http,f=!l,u="CookieSet.json",d=(()=>{if(f){return{request:e,fs:t,path:o}}return null})(),p=(e,t,o,r,n)=>(void 0!==a&&t&&(a[t].notify?a[t].notify+=`\n${e}: å¼‚å¸¸, å·²è¾“å‡ºæ—¥å¿— â€¼ï¸ (2)`:a[t].notify=`${e}: å¼‚å¸¸, å·²è¾“å‡ºæ—¥å¿— â€¼ï¸`,a[t].error=1),console.log(`\nâ€¼ï¸${e}å‘ç”Ÿé”™è¯¯\nâ€¼ï¸åç§°: ${o.name}\nâ€¼ï¸æè¿°: ${o.message}${JSON.stringify(o).match(/"line"/)?`\nâ€¼ï¸è¡Œåˆ—: ${JSON.stringify(o)}`:""}${r&&r.status?`\nâ€¼ï¸çŠ¶æ€: ${r.status}`:""}${n?`\nâ€¼ï¸å“åº”: ${r&&503!=r.status?n:"Omit."}`:""}`));return{AnError:p,isRequest:r,isJSBox:l,isSurge:n,isQuanX:i,isLoon:s,isNode:f,notify:(e,t,o,r)=>{const a=e=>{if(!e)return e;if("string"==typeof e)return s?e:i?{"open-url":e}:n?{url:e}:void 0;if("object"==typeof e){if(s){return{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]}}if(i){return{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl}}if(n){return{url:e.url||e.openUrl||e["open-url"]}}}};console.log(`${e}\n${t}\n${o}`),i&&$notify(e,t,o,a(r)),n&&$notification.post(e,t,o,a(r)),l&&$push.schedule({title:e,body:t?t+"\n"+o:o})},write:(e,t)=>{if(i)return $prefs.setValueForKey(e,t);if(n)return $persistentStore.write(e,t);if(f)try{d.fs.existsSync(d.path.resolve(__dirname,u))||d.fs.writeFileSync(d.path.resolve(__dirname,u),JSON.stringify({}));const o=JSON.parse(d.fs.readFileSync(d.path.resolve(__dirname,u)));return e&&(o[t]=e),e||delete o[t],d.fs.writeFileSync(d.path.resolve(__dirname,u),JSON.stringify(o))}catch(e){return p("Node.jsæŒä¹…åŒ–å†™å…¥",null,e)}return l?e?$file.write({data:$data({string:e}),path:`shared://${t}.txt`}):$file.delete(`shared://${t}.txt`):void 0},read:e=>{if(i)return $prefs.valueForKey(e);if(n)return $persistentStore.read(e);if(f)try{return d.fs.existsSync(d.path.resolve(__dirname,u))?JSON.parse(d.fs.readFileSync(d.path.resolve(__dirname,u)))[e]:null}catch(e){return p("Node.jsæŒä¹…åŒ–è¯»å–",null,e)}return l?$file.exists(`shared://${e}.txt`)?$file.read(`shared://${e}.txt`).string:null:void 0},done:(e={})=>{if(i)return $done(e);n&&(r?$done(e):$done())}}}(),a={};const f="CookiesJD";function u(e,t,o="cookie"){let r,n,i=(e||t||"").split(/pt_pin=(.+?);/)[1],s=l.read(f);try{s=d(JSON.parse(s||"[]"))}catch(e){l.notify("äº¬ä¸œç­¾åˆ°","","Cookie JSONæ ¼å¼ä¸æ­£ç¡®, å³å°†æ¸…ç©º\nå¯å‰å¾€æ—¥å¿—æŸ¥çœ‹è¯¥æ•°æ®å†…å®¹!"),console.log(`äº¬ä¸œç­¾åˆ°Cookie JSONæ ¼å¼å¼‚å¸¸: ${e.message||e}\næ—§æ•°æ®å†…å®¹: ${s}`),s=[]}for(let e=0;e<s.length;e++)if(s[e].cookie&&new RegExp(`pt_pin=${i};`).test(s[e].cookie)){r=e;break}return t&&void 0!==r?(n=s[r][o]===t?-1:2,s[r][o]=t,r+=1):t&&"cookie"===o&&(s.push({cookie:t}),n=1,r=s.length),{total:d(s),type:n,item:r,name:decodeURIComponent(i)}}function d(e){let t,o,r={};return e.reduce(((e,n)=>(o=((n.cookie||"").match(/(pt_key|pt_pin)=.+?;/g)||[]).sort(),2==o.length?(t=o[1])&&!r[t]&&(n.userName=n.userName?n.userName:decodeURIComponent(t.split(/pt_pin=(.+?);/)[1]),n.cookie=o.join(""),n.jrBody&&!n.jrBody.includes("reqData=")&&(console.log(`å¼‚å¸¸é’¢é•šBodyå·²è¿‡æ»¤: ${n.jrBody}`),delete n.jrBody),r[t]=e.push(n)):console.log(`å¼‚å¸¸äº¬ä¸œCookieå·²è¿‡æ»¤: ${n.cookie}`),e)),[])}(async function(){if(s){const e=l.write("",f);throw new Error(`Cookieæ¸…é™¤${e?"æˆåŠŸ":"å¤±è´¥"}, è¯·æ‰‹åŠ¨å…³é—­è„šæœ¬å†…"DeleteCookie"é€‰é¡¹`)}if(!l.isRequest)throw new Error("è„šæœ¬ç»ˆæ­¢, æœªè·å–Cookie â€¼ï¸");!function(){const e=$request;if("OPTIONS"!=e.method&&e.headers){const t=e.headers.Cookie||e.headers.cookie||"",o=t.match(/(pt_key|pt_pin)=.+?;/g);if(/^https:\/\/(me-|)api(\.m|)\.jd\.com\/(client\.|api)/.test(e.url)){if(!o||2!=o.length)throw new Error("å†™å…¥Cookieå¤±è´¥, å…³é”®å€¼ç¼ºå¤±\nå¯èƒ½åŸå› : éç½‘é¡µè·å– â€¼ï¸");{const e=u(null,o.join(""));if(-1!==e.type){const t=l.write(JSON.stringify(e.total,null,2),"CookiesJD");l.notify(`ç”¨æˆ·å: ${e.name}`,"",`${2==e.type?"æ›´æ–°":"å†™å…¥"}äº¬ä¸œ [è´¦å·${e.item}] Cookie${t?"æˆåŠŸ ğŸ‰":"å¤±è´¥ â€¼ï¸"}`)}else console.log(`\nç”¨æˆ·å: ${e.name}\nä¸å†å²äº¬ä¸œ [è´¦å·${e.item}] Cookieç›¸åŒ, è·³è¿‡å†™å…¥ âš ï¸`)}}else if(/^https:\/\/ms\.jr\.jd\.com\/gw\/generic\/hy\/h5\/m\/appSign\?/.test(e.url)&&e.body){const o=u(t,e.body,"jrBody");if(!o.type)throw new Error("å†™å…¥é’¢é•šBodyå¤±è´¥\næœªè·å–è¯¥è´¦å·Cookieæˆ–å…³é”®å€¼ç¼ºå¤±â€¼ï¸");{const e=l.write(JSON.stringify(o.total,null,2),"CookiesJD");l.notify(`ç”¨æˆ·å: ${o.name}`,"",`è·å–äº¬ä¸œ [è´¦å·${o.item}] é’¢é•šBody${e?"æˆåŠŸ ğŸ‰":"å¤±è´¥ â€¼ï¸"}`)}}else if("http://www.apple.com/"===e.url)throw new Error("ç±»å‹é”™è¯¯, æ‰‹åŠ¨è¿è¡Œè¯·é€‰æ‹©ä¸Šä¸‹æ–‡ç¯å¢ƒä¸ºCron âš ï¸")}else if(!e.headers)throw new Error("å†™å…¥Cookieå¤±è´¥, è¯·æ£€æŸ¥åŒ¹é…URLæˆ–é…ç½®å†…è„šæœ¬ç±»å‹ âš ï¸")}()})().catch((e=>{l.notify("äº¬ä¸œç­¾åˆ°","",e.message||JSON.stringify(e))})).finally((()=>{l.isJSBox&&$intents.finish(l.st),l.done()}));export{r as default};
